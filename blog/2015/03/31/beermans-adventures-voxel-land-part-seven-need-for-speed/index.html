<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Beerman&#39;s adventures in voxel-land, part 7 : Need for speed</title>

    

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href='http://example.org/css/beercave.css' >
    <link href="https://fonts.googleapis.com/css?family=Orbitron|Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.css" integrity="sha256-PF6MatZtiJ8/c9O9HQ8uSUXr++R9KBYu4gbNG5511WE=" crossorigin="anonymous" />
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>




</head><body><nav class="navbar navbar-expand-md fixed-top navbar-dark bg-dark-bc">
    <div class="container-fluid">
        <a class="navbar-brand" href="/" aria-label="home">
        <img src='http://example.org/img/logo.png'/>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
                <a class="nav-link" href='http://example.org/games'>Games</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href='http://example.org/blog'>Blog</a>
            </li>
        </ul>
    </div>
    </div>
</nav><div id="content">
<div class="container mt-3">
    <div class="row">
        <div class="col-md-8 posts">
            
            <article>
                <header class="post-header">
                    <h1>
                        <a href="http://example.org/blog/2015/03/31/beermans-adventures-voxel-land-part-seven-need-for-speed/">Beerman&#39;s adventures in voxel-land, part 7 : Need for speed</a>
                    </h1>
                    <time datetime='31003-03-03'>
                        <span class="day">31</span>
                        <span class="month">Mar 2015</span>
                    </time>
                </header>
                <section class="post-content">
                    <p>Previous Entries : <a href="/blog/2015/01/14/beermans-adventures-voxel-land">Intro</a>
<a href="/blog/2015/01/15/beermans-adventures-voxel-land-part-one-triangles-cubes-blocks-oh-my">Part 1</a>
<a href="/blog/2015/01/20/beermans-adventures-voxel-land-part-two-blowing-chunks">Part 2</a>
<a href="/blog/2015/01/22/beermans-adventures-voxel-land-part-three-it-moves">Part 3</a>
<a href="/blog/2015/01/25/beermans-adventures-voxel-land-part-four-now-featuring-actual-gameplay">Part 4</a>
<a href="/blog/2015/03/25/beermans-adventures-voxel-land-part-five-the-hard-parts">Part 5</a>
<a href="/blog/2015/03/25/beermans-adventures-voxel-land-part-six-the-best-laid-plans">Part 6</a></p>

<p>With the basics of the trench runner working, I wanted to take a look at a performance issue that&rsquo;d been giving me trouble - the initial version of the engine was pretty much limited to only seeing about 10 chunks ahead if I wanted to keep it at 60fps, which was giving me some pretty visible popup on the far end of the trench.</p>

<p>The problem was in the mesh generation for my chunks. I had the basic optimisation in place of not adding faces to the mesh that were in between adjacent filled blocks, but that meant that for a completely solid chunk I was still rendering hundreds of little cubes where one would be enough.</p>

<p>A spot of googling helped me find something called a greedy meshing algorithm. Basically, you take 2d slices across each chunk in every direction, then for each slice, the greedy algorithm starts in the top left corner and identifies the largest rectangle it can make consisting only of filled squares. Once that&rsquo;s done, it adds the rectangle to the mesh and continues from the next unprocessed square until all squares in the slice have been processed</p>

<div class="row">
<div class="col-md-6">
<figure>
    <img src="meshing1.png"
         alt="Start with top left filled square."/> 
</figure>
</div>
<div class="col-md-6">
<figure>
    <img src="meshing2.png"
         alt="Expand right and down until we can&#39;t make a bigger rectangle."/> 
</figure>
</div>
<div class="col-md-6">
<figure>
    <img src="meshing3.png"
         alt="Add rectangle to mesh and remove squares from slice."/> 
</figure>
</div>
<div class="col-md-6">
<figure>
    <img src="meshing4.png"
         alt="Continue with next filled square."/> 
</figure>
</div>
</div>

<p>After a <em>lot</em> of swearing, I got a successful implementation up and running, which cut my rendering action from upwards of 10 million triangles a frame to somewhere closer to 300,000, and let me push the render distance out past 100 chunks without affecting the framerate.</p>

<div class="row">
<div class="col-md-6">
<figure>
    <img src="unoptimised.png"
         alt="Before meshing"/> <figcaption>
            <p>Before meshing</p>
        </figcaption>
</figure>
</div>
<div class="col-md-6">
<figure>
    <img src="optimised.png"
         alt="After meshing"/> <figcaption>
            <p>After meshing</p>
        </figcaption>
</figure>
</div>
</div>

<p>And here it is in action</p>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/5cTDfB4jubc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div> 
                </section>
                <section class="post-footer clearfix row justify-content-between">
                    <div class="col sharing-links">
                        <a href="https://www.facebook.com/sharer/sharer.php?u=http%2f%2fexample.org%2fblog%2f2015%2f03%2f31%2fbeermans-adventures-voxel-land-part-seven-need-for-speed%2f" class="Share-buttons-item Share-buttons-item--social"
                            target="_blank" data-service="facebook">
                            <i class="fab fa-facebook" data-toggle="tooltip" title="" data-original-title="Twitter"></i>
                        </a>
                        
                        <a href="https://twitter.com/intent/tweet?url=http%2f%2fexample.org%2fblog%2f2015%2f03%2f31%2fbeermans-adventures-voxel-land-part-seven-need-for-speed%2f&text=beermans-adventures-in-voxel-land-part-7-need-for-speed" class="Share-buttons-item Share-buttons-item--social"
                            target="_blank" data-service="twitter">
                            <i class="fab fa-twitter" data-toggle="tooltip" title="" data-original-title="Twitter"></i>
                        </a>
                        
                        <a href="https://www.stumbleupon.com/badge/?url=http%2f%2fexample.org%2fblog%2f2015%2f03%2f31%2fbeermans-adventures-voxel-land-part-seven-need-for-speed%2f" class="Share-buttons-item Share-buttons-item--social"
                            target="_blank" data-service="stumbleupon">
                            <i class="fab fa-stumbleupon" data-toggle="tooltip" title="" data-original-title="Twitter"></i>
                        </a>
                        <a href="https://www.reddit.com/submit?url=http%2f%2fexample.org%2fblog%2f2015%2f03%2f31%2fbeermans-adventures-voxel-land-part-seven-need-for-speed%2f" class="Share-buttons-item Share-buttons-item--social"
                            target="_blank" data-service="reddit">
                            <i class="fab fa-reddit-alien" data-toggle="tooltip" title="" data-original-title="Twitter"></i>
                        </a>
                    </div>
                   
                </section>
            </article>
            
            
            <section class="prev-next">
              
            <a href="http://example.org/blog/2015/03/25/beermans-adventures-voxel-land-part-six-the-best-laid-plans/" class="float-left">&lt; Beerman&#39;s adventures in voxel-land, part 6 : The best laid plans</a>
            
        
              
                <a href="http://example.org/blog/2015/07/06/egad-a-post/" class="float-right">Egad! A post! &gt;</a>
            
            </section>
        </div>
        
        <div class="col-md-4">
            <div class="sidebar">
                <section class="sidebar-content">
                    <article id="profile">
                        <a href='http://example.org/img/beerman-cutout.png' data-toggle="lightbox">
                            <img src='http://example.org/img/beerman-cutout-smol.png' title="Judge Beerman">
                        </a>
                        <h1>
                            Beerman's blog
                        </h1>
                        <p>Real nerds. Real talk. Call now.</p>
                        <div class="social-links">
                            <a href="https://twitter.com/BeercaveGames">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>

                            <a href="https://www.youtube.com/user/b33rman/videos">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                            
                        </div>
                    </article>
                    <article id="post-list">
                        <h1>Latest posts</h1>
                        
                        <ul>
                            
                            <li>
                                <a href="http://example.org/blog/2015/07/06/egad-a-post/">Egad! A post!</a>
                            </li>
                            
                            <li>
                                <a href="http://example.org/blog/2015/03/31/beermans-adventures-voxel-land-part-seven-need-for-speed/">Beerman&#39;s adventures in voxel-land, part 7 : Need for speed</a>
                            </li>
                            
                            <li>
                                <a href="http://example.org/blog/2015/03/25/beermans-adventures-voxel-land-part-six-the-best-laid-plans/">Beerman&#39;s adventures in voxel-land, part 6 : The best laid plans</a>
                            </li>
                            
                            <li>
                                <a href="http://example.org/blog/2015/03/25/beermans-adventures-voxel-land-part-five-the-hard-parts/">Beerman&#39;s adventures in voxel-land, part 5 : The hard parts</a>
                            </li>
                            
                            <li>
                                <a href="http://example.org/blog/2015/01/25/beermans-adventures-voxel-land-part-four-now-featuring-actual-gameplay/">Beerman&#39;s adventures in voxel-land, part 4 : Now featuring actual gameplay</a>
                            </li>
                            
                        </ul>
                    </article>
                    <article id="post-tags">
                        <h1>Tags</h1>
                        
                        <ul>
                        
                        
                        
                        
                        
                        
                        <li>
                        <a href="/tags/voxel-engine" class="btn btn-default" role="button">voxel-engine <span class="badge badge-dark">3</span></a>
                        </li>
                        
                        
                        </ul>
                    </article>
                    </ul>

            </div>
        </div>
    </div>
</div>



        </div><footer>
    <section class="container">
       
TODO : Add a nice looking footer here with links and stuff
    </section>
</footer></body>
</html>
